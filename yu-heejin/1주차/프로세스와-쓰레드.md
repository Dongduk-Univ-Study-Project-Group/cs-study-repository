## 프로세스

- 운영체제로부터 자원을 할당받은 작업의 단위
- 메모리 상에서 실행중인 프로그램
- 프로세스는 최소 하나의 스레드를 보유하고 있으며, 각각 별도의 주소 공간을 독립적으로 할당 받는다.
    - 원칙적으로 서로 다른 프로세스 간의 메모리 공간 접근은 허용되지 않는다.
    - 프로세스간 서로 다른 자원에 접근하려면 프로세스 간 통신을 해야한다.

## 스레드

- 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위
- 프로세스 안에서 실행되는 흐름 단위
- 프로세스의 stack을 따로 할당받고, 나머지 영역은 ㅅ로 공유한다.

## 프로그램 → 프로세스 → 스레드

### 프로그램 → 프로세스

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e2572116-a756-4dcb-8c97-2ca2af80b911/Untitled.png)

- 프로그램이란 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가지 않은 정적인 상태를 의미한다.
    - **메모리에 올라가 있지 않은** : 아직 운영체제가 프로그램에게 독립적인 메모리 공간을 할당해주지 않았다는 뜻이다. 모든 프로그램은 운영체제가 실행되기 위한 메모리 공간을 할당해줘야 실행할 수 있다.
    - **정적인 상태** : 아직 실행되지 않은 상태를 의미한다.
    - 즉, 프로그램이란 **아직 실행되지 않은 파일 그 자체**를 가리킨다.
- 이러한 정적인 프로그램을 실행하는 경우, 해당 파일이 컴퓨터 메모리에 올라가게 되는데, 이를 **동적인 상태**라고 하며, 이 상태의 프로그램을 **프로세스**라고 한다.
    - 실행되고 있는 컴퓨터 프로그램
    - 스케줄링 단계에서 ‘작업’과 같은 단어라고 봐도 괜찮다.
    - 프로세스 = 작업중인 프로그램

### 프로세스 → 스레드

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5c8581bc-a37b-4f2d-a21a-deeb368d44c1/Untitled.png)

- 이전에는 프로그램을 실행할 때, 실행 시작부터 끝까지 프로세스 하나만을 사용하여 진행했다.
    - 하지만 시간이 지날수록 프로그램이 복잡해지고, 프로세스 하나만을 사용해 프로그램을 실행하기에는 벅차게 되었다.
    - 실제로도 현재 프로그램 하나가 단순히 한 가지 작업만을 하는 경우는 없다.
- **한 프로그램을 처리하기 위한 프로세스를 여러개를 만드는 것은 불가능하다!**
    - 운영체제는 안전성을 위해 **프로세스마다 자신에게 할당된 메모리 내의 정보에만 접근할 수 있도록 제약**을 두고 있으며, 이를 벗어나는 정보에 접근하려면 오류가 발생하기 때문이다.
- 프로세스와는 다른 **더 작은 실행 단위 개념**이 필요해졌고, 이를 **스레드**라고 한다.
- 스레드는 위에서 언급한 프로세스 특성의 한계를 해결하기 위해 만들어진 개념
    - 프로세스와 달리 스레드 간 메모리를 공유하며 작동한다.
    - 스레드끼리 프로세스의 자원을 공유하면서 프로세스 실행 흐름의 일부가 되는 것
    - 즉, 스레드는 프로세스의 코드에 정의된 절차에 따라 실행되는 특정한 수행 경로

## 프로세스와 스레드의 작동 방식

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2df1fb20-9b50-4feb-bc70-4cbf8af24631/Untitled.png)

- 프로세스가 메모리에 올라갈 때, 운영체제로부터 시스템 자원을 할당받는다
    - 운영체제는 프로세스마다 각각 독립된 메모리 영역을 **Code, Data, Stack, Heap**의 형식으로 할당해준다.
    - 각각 **독립된 메모리 영역을 할당해주기 때문에 프로세스는 다른 프로세스의 변수나 자료에 접근할 수 없다.**
- 각 영역의 특징은 다음과 같다. (이와 관련해서는 더 자세히 공부하는 것이 필요할 것 같다.)
    - 코드 영역 : 프로그래머가 작성한 프로그램이 코드 영역에 작성된다.
    - 데이터 영역 : 코드가 실행되면서 사용한 변수나 파일들의 각종 데이터들이 모여있다.
    - 스택 영역 : 호출한 함수가 종료되면 되돌아올 메모리의 주소를 스택에 저장하거나 변수 사용 범위에 영향을 미치는 영역을 구현할 때 사용된다.
    - 힙 영역 : 동적으로 할당되는 데이터들을 위해 존재하는 공간
    - **코드 영역과 데이터 영역**은 선언할 때 크기가 결정되는 **정적 영역**이지만, **스택 영역과 힙 영역**은 프로세스가 실행되는 동안 크기가 늘었다 줄기도 하는 **동적 영역**이다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f60cb818-c5a8-4b3f-9b3e-a2cf7cdea11b/Untitled.png)

- 이와 달리 스레드는 메모리를 서로 공유할 수 있다.
    - 프로세스가 할당받는 메모리 영역 내에서 **Stack 형식으로 할당된 메모리 영역은 따로 할당받고, 나머지 Code, Data, Heap 형식으로 할당된 메모리 영역을 공유한다.**
    - 따라서 각각의 스레드는 별도의 스택을 가지고 있지만, **힙 메모리는 서로 읽고 쓸 수 있게 된다.**

### **위 두 사진에서 프로세스와 스레드의 더 중요한 차이를 알 수 있다!**

- 만약 한 프로세스를 실행하다가 오류가 발생해 프로세스가 강제로 종료된다고 해도, 공유하고 있는 파일을 손상시키는 경우가 아니라면 영향을 주지 않는다.
- 하지만 스레드의 경우는 다르다. 스레드는 Code, Data, Heap 메모리 영역의 내용을 공유하기 때문에 **어떤 스레드 하나에서 오류가 발생한다면 같은 프로세스 내의 다른 스레드 모두가 강제로 종료된다.**

### 위 방식대로 메모리를 공유하는 이유는 무엇일까?

- 스레드는 ‘흐름의 단위’라고 정의하는데, 정확히 CPU의 입장에서 최소 작업 단위가 된다.
    - **CPU는 작업을 처리할 때 스레드를 최소 단위로 삼고 작업을 한다.**
    - 반면 운영체제는 이렇게 작은 단위까지 직접 작업하지 않기 때문에 **운영체제 관점에서는 프로세스가 최소 작업 단위가 된다.**
- 하나의 프로세스는 하나 이상의 스레드를 가진다.
    - 따라서 **운영체제 관점에서는 프로세스가 최소 작업 단위이기 때문에 같은 프로세스 소속의 스레드끼리 메모리를 공유하지 않을 수 없다.**

## 멀티테스킹과 멀티스레드

### 멀티테스킹

- **하나의 운영체제 안에서 여러 프로세스가 실행되는 것**
- OS를 통해 CPU가 작업하는데 필요한 자원(시간)을 프로세스 또는 스레드간에 나누는 행위
    - 이를 통해 여러 응용 프로그램을 동시에 열고 작업할 수 있다.
    - 음악을 들으면서 웹 서핑을 하고, 메신저의 메시지를 확인할 수 있는 이유는 멀티 태스킹 때문
- 여러 프로세스가 동시에 실행되는 것처럼 보이지만 사실은 아니다.
    - 이에 대해서는 운영체제 스케줄링을 공부하면 알 수 있다.

### 멀티스레드

- **하나의 프로세스가 여러 작업을 여러 스레드를 사용하여 동시에 처리하는 것**을 의미한다.
- 장점
    - Context-Switching 할 때 공유하고 있는 메모리만큼의 메모리 자원을 아낄 수 있다.
        - 프로세스 간의 Context-Switching 시에는 많은 자원 손실이 발생하지만, 스레드간의 Context-Switching 에서는 메모리를 공유하고 있는만큼 부담을 덜 수 있다.
    - 스레드는 프로세스 내의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 통신에 부담이 적어 응답 시간이 빠르다.
- 단점
    - 스레드 하나가 프로세스 내 자원을 망쳐버버리면 모든 프로세스가 종료된다.
    - 자원을 공유하기 때문에 필연적으로 동기화 문제가 발생할 수밖에 없다.

### 멀티스레드의 동기화 문제 (Synchronization Issue)

- 멀티 쓰레드를 사용할 경우, 각각의 스레드 중 어떤 것이 어떤 순서로 실행될 지 그 순서를 알 수 없다.
    - 만약 A 스레드가 어떤 자원을 사용하다가 B 스레드로 제어권이 넘어간 후, B 스레드가 해당 자원을 수정했을 때 다시 제어권을 받은 A 스레드가 해당 자원에 접근하지 못하거나 바뀐 자원에 접근하게 되는 오류가 발생할 수 있다.
    - 이처럼 **여러 스레드가 함께 전역 변수를 사용할 경우 발생할 수 있는 충돌을 동기화 문제**라고 한다.
- 스케줄링은 운영체제가 자동으로 해주지 않기 때문에 프로그래머가 적절한 기법을 직접 구현해야하므로 프로그래밍할 때 멀티 스레드를 사용하려면 신중해야한다.

## 다른 프로세스에 대한 정보 접근

- 프로세스 간 정보를 공유하는 방법엔 다음과 같은 방법들이 있다.
    - IPC (Inter-Process Communication)
    - LPC (Local inter-Process Communication)
    - 별도 공유 메모리를 만들어 정보를 주고받도록 설정
- 다만 이 경우에는 단순히 CPU 레지스터 교체뿐만 아니라 RAM과 CPU 사이의 캐시 메모리까지 초기화되기 떄문에 자원 부담이 크다.

## 참고 자료

- [https://velog.io/@raejoonee/프로세스와-스레드의-차이](https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4)
- [https://zeroco.tistory.com/75](https://zeroco.tistory.com/75)
- [https://inpa.tistory.com/entry/👩‍💻-프로세스-⚔️-쓰레드-차이](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4)